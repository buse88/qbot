# 群管理模块测试指南

## 重要提示

⚠️ **必须重启QBot才能使所有修改生效！**

## 测试步骤

### 1. 重启QBot

```bash
# 停止当前运行的QBot（如果正在运行）
# Ctrl+C 或关闭终端

# 重新启动QBot
cd z:\share\qbot\start
python main.py
```

### 2. 检查启动日志

启动后应该看到以下日志：

```
[系统] ModuleLoader 已初始化
[系统] 线报收集模块加载成功
[系统] 线报转发模块加载成功
[系统] 返利模块加载成功
[系统] 群管理模块加载成功  ← 确认这一行出现
[群管理模块] 模块已加载 (v1.0.0)
[群管理模块] 监听群: [980439110]  ← 检查群号是否正确
[群管理模块] 管理员: [1005008286]  ← 检查管理员QQ是否正确
[群管理模块] 管理员机器人优先级: [435438881, 3121201314]
```

### 3. 等待心跳事件

启动后等待几秒，应该看到：

```
[系统] ✅ 通过心跳检测到 QQ: 435438881 在线
[系统] 当前在线机器人: [435438881]
```

### 4. 测试撤回功能

在配置的群（980439110）中，使用管理员账号（1005008286）发送：

#### 测试1：撤回指定消息ID
```
撤回 389860983
```

预期响应：
```
✅ 已发送撤回请求: 消息ID 389860983
```

#### 测试2：撤回最近5条消息
```
撤回 5
```

预期响应：
```
✅ 正在获取最近 5 条消息并撤回...
```

#### 测试3：撤回全部消息
```
撤回全部
```

预期响应：
```
✅ 正在获取所有消息并撤回...
```

## 配置检查

### 当前配置（需要根据实际情况修改）

打开 `z:\share\qbot\start\config.py`，找到 `GROUP_ADMIN_CONFIG`：

```python
GROUP_ADMIN_CONFIG = {
    "enabled": True,
    "priority": 15,
    "settings": {
        # ⚠️ 修改为实际的群号
        "watched_groups": [980439110],  # 你的测试群号
        
        # ⚠️ 修改为实际的管理员QQ
        "admin_qq_list": [1005008286],  # 你的QQ号
        
        # ⚠️ 修改为实际的机器人QQ号（按优先级排序）
        "admin_bot_priority": [435438881, 3121201314],
    }
}
```

## 调试日志说明

### 正常日志流程

1. **接收消息**
```
[MESSAGE_RECEIVED] 群980439110 | 用户1005008286: 撤回 123456
```

2. **优先级检查**
```
[群管理模块] === 优先级检查开始 ===
[群管理模块] 当前机器人: 435438881
[群管理模块] 管理员机器人优先级列表: [435438881, 3121201314]
[群管理模块] 当前在线机器人: [435438881]  ← 应该有值
[群管理模块] 在线的管理员机器人: [435438881]
[群管理模块] 优先级最高的在线管理员机器人: 435438881
[群管理模块] 当前机器人(435438881) 应该响应
```

3. **发送撤回请求**
```
[群管理模块] 已发送撤回请求: message_id=123456
```

## 常见问题

### Q1: "当前在线机器人: []" 是空的

**原因**：代码修改后没有重启QBot

**解决**：重启QBot

### Q2: 模块没有响应

**检查**：
1. 是否在配置的监听群中？
2. 发送指令的用户是否是管理员？
3. 检查日志中的优先级检查部分

### Q3: 撤回没有生效

**说明**：当前实现只发送撤回请求，实际撤回需要OneBot API响应。如果消息超过2分钟，QQ官方限制无法撤回。

## 下一步优化

1. 实现引用撤回功能
2. 实现@撤回功能
3. 完善批量撤回的响应处理
4. 添加撤回结果反馈
